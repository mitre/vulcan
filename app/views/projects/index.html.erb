<div class="row">
    <div class="col-lg-12">
      <div class="card-box">
        <h4 class="m-t-0 header-title">Projects</h4>
        <table id="projects-datatable" class="table table-striped table-bordered toggle-circle m-b-0" data-page-size="7">
          <thead>
            <tr>
              <th>Name</th>
              <th>Title</th>
              <th>Maintainer</th>
              <th></th>
            </tr>
          </thead>
          <div class="form-inline m-b-20">
              <div class="row">
                  <div class="col-md-6 text-center text-right">
                      <input id="projects-search" type="text" placeholder="Search" class="form-control" autocomplete="on">
                  </div>
              </div>
          </div>
          <tbody>
            <% @projects.each do |project| %>
              <tr>
                <td><%= project.name %></td>
                <td><%= project.title %></td>
                <td><%= project.maintainer %></td>
                <td>
                  <div class="btn-group">
                      <button type="button" class="btn btn-secondary dropdown-toggle waves-effect" data-toggle="dropdown" aria-expanded="false"> Actions <span class="caret"></span> </button>
                      <div class="dropdown-menu">
                          <%= link_to 'Show Controls', project, class: 'dropdown-item btn btn-success' %>
                          <%= link_to 'Edit Controls', project_edit_controls_path(project), class: 'dropdown-item btn btn-info' if current_user.has_role?(:vendor) %>
                          <%= link_to 'Test Controls', test_path(project), class: 'dropdown-item btn btn-primary' %>
                          <%= link_to 'Edit Profile', edit_project_path(project), class: 'dropdown-item btn btn-warning' %>
                          <%= link_to 'Delete', project, method: :delete, data: { confirm: 'Are you sure?' }, class: 'dropdown-item btn btn-danger' %>
                      </div>
                  </div>
                </td>
                <td>
                  <div class="btn-group">
                      <button type="button" class="btn btn-secondary dropdown-toggle waves-effect" data-toggle="dropdown" aria-expanded="false"> Export As <span class="caret"></span> </button>
                      <div class="dropdown-menu">
                          <%= link_to 'Excel', project_path(project, format: :xlsx), class: 'dropdown-item btn btn-primary'%>
                          <%= link_to 'InSpec Profile', project_path(project, format: :json), class: 'dropdown-item btn btn-warning'%>
                      </div>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr class="active">
                <td colspan="5">
                    <div class="text-right">
                        <ul class="pagination pagination-split justify-content-end footable-pagination m-t-10 m-b-0"></ul>
                    </div>
                </td>
            </tr>
          </tfoot>
        </table>
        <br>
        <h4 class="m-t-0 header-title">Pending Projects</h4>
        <table id="pending-projects-datatable" class="table table-striped table-bordered toggle-circle m-b-0" data-page-size="7">
          <thead>
            <tr>
              <th>Name</th>
              <th>Title</th>
              <th>Maintainer</th>
              <th></th>
            </tr>
          </thead>
          <div class="form-inline m-b-20">
              <div class="row">
                  <div class="col-md-6 text-center text-right">
                      <input id="pending-projects-search" type="text" placeholder="Search" class="form-control" autocomplete="on">
                  </div>
              </div>
          </div>
          <tbody>
            <% @pending_projects.each do |project| %>
              <tr value="<%= project.id %>">
                <td><%= project.name %></td>
                <td><%= project.title %></td>
                <td><%= project.maintainer %></td>
                <td>
                  <div class="btn-group">
                      <button type="button" class="btn btn-secondary dropdown-toggle waves-effect" data-toggle="dropdown" aria-expanded="false"> Actions <span class="caret"></span> </button>
                      <div class="dropdown-menu">
                          <a onclick="review_project(<%= project.id %>)" class="dropdown-item btn btn-info">Review Project</a>
                          <%= link_to 'Edit/Collapse Controls', edit_project_path(project), class: 'dropdown-item btn btn-warning'%>
                          <%= link_to 'Delete', project, method: :delete, data: { confirm: 'Are you sure?' }, class: 'dropdown-item btn btn-danger' %>
                      </div>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr class="active">
                <td colspan="5">
                    <div class="text-right">
                        <ul class="pagination pagination-split justify-content-end footable-pagination m-t-10 m-b-0"></ul>
                    </div>
                </td>
            </tr>
          </tfoot>
        </table>
        
        
        <br>
        <div class='row'>
          <h3>Upload A Project</h3>
          <i class="mdi mdi-information-outline" style='padding: 8px;' data-toggle="popover" data-content="You can upload a STIG from an XCCDF or CSV file. Or you can upload an InSpec profile from a Tarball, JSON, or a repository link." id="upload_pop"></i>
        </div>
        <%= form_tag(upload_project_path, multipart: true, :html => {class: 'form-control'}) do %>
          <div class='row'>
            <div class='col-lg-1'>
              <label>Upload Profile</label>
              <div class="fileupload btn btn-secondary waves-effect">
                  <span><i class="ion-upload m-r-5"></i>Upload</span>
                  <%= file_field_tag :file, :class => "upload" %>
              </div>
            </div>
            <div class='col-lg-3'>
              <label>Upload From Repository Link</label>
              <%= text_field_tag :url, nil,class: "form-control" %>
            </div>
          </div>
          <br>
          <div class="actions">
            <%= submit_tag 'Submit', :class => "btn btn-primary" %>
          </div>
        <% end %>
      </div>
  </div>
</div>

<div class="modal fade" id="reviewProjectModal" tabindex="-1" role="dialog" aria-labelledby="reviewProjectModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reviewControlModalLabel">Review Project</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="reviewProjectForm">
      </div>
    </div>
  </div>
</div>

<script>
$('#upload_pop').popover();
  // Add event listener for opening and closing details
  function review_project(project_id) {
    hsh = "#review_modal_card";
    url = '/project/' + project_id + '/review_project';
    var card_holder = $(hsh);
    if (project_id != undefined) {
      if ($('#reviewProjectForm').length) {
        $('#reviewProjectForm').empty();
      }
      $.ajax({
        url: url,
        type: "get",
        datatype: 'json',
        success: function(data) {
          $('#reviewProjectForm').append(data);
          $('#reviewProjectModal').modal();
        },
        error: function() {
          console.log("Error occured");
        }   
      });
    }
  }
</script>

